<div class="span3">
  <% if params[:template] == "question" %>
    <h4 class="visible-phone">Ask a question</h4>
    <div id="research-note-detail" class="hidden-phone">
      <h3>Use this form to ask about <%= params[:tags].split(':').last %></h3>
      <% if DrupalTag.follower_count(params[:tags]) > 0 %><p><%= DrupalTag.follower_count(params[:tags]) %> people have signed up to answer questions on this topic.</p><% end %>
      <ul>
        <li>Need to learn more?</li>
      <hr />
    </div>

	<% else %>
		<% if not(params[:tags].blank?)%>
			<% if params[:tags].include? "GeoDreamer"%>
				<h3 class="hidden-phone"><i class="icon-file"></i> What's a <br />GeoDreamer?</h3>
				<h4 class="visible-phone"><i class="icon-file"></i> What's a GeoDreamer?</h4>
				<p class="visible-phone"><a onClick="$('#GeoDreamer-note-detail').toggleClass('hidden-phone')">Read more &raquo;</a></p>
				<div id="GeoDreamer-note-detail" class="hidden-phone">
				<p>At GeoMakers, we all collaborate to invent and improve open source Maker's projects that involve mapping, remote sensing, navigating, or better understanding our world geographically, as it changes (or has changed) over time.  All this begins with <a href ="./tag/GeoDreamer" style = "font-weight: bold">GeoDreams</a> - or visions of amazing geo-related things to make.  GeoDreams are one way that we share what we know, what we don't know, and what we aspire to accomplish together.  In GeoDreams you can ask questions, pose challenges, and share your vision of the future of GeoMaking!</p>
				<p><b>GeoDreams can be:</b></p>
				<ul>
					<li>sketches and diagrams of your idea</li>
					<li>outlandish and unfounded ideas</li>
					<li>others&#39; ideas that you would like to see become reality&#33;</li>
					<li>etc.&#33;</li>
				</ul>
				<hr />
				<p><b><a href="" target="_blank"><i class="icon icon-film"></i> Watch a 30 second video on posting GeoDreams&#33; &raquo;</a></b></p>
			<% elsif params[:tags].include? "GeoMaker"%>
				<h3 class="hidden-phone"><i class="icon-file"></i> What's a <br />GeoMaker?</h3>
				<h4 class="visible-phone"><i class="icon-file"></i> What's a GeoMaker?</h4>
				<p class="visible-phone"><a onClick="$('#GeoMaker-note-detail').toggleClass('hidden-phone')">Read more &raquo;</a></p>
				<div id="GeoMaker-note-detail" class="hidden-phone">
				<p>GeoMakers bring GeoDreams to life&#33;  They actually MAKE things that map, sense, navigate or help us better understand the world around us, as it changes (or has changed) over time.  Sometimes, these GeoMaker projects will be implementations of other's <a href ="./tag/GeoDreamer" style = "font-weight: bold">GeoDreams</a>.  Sometimes they will be something you just hack together.  Once GeoMakers have made something, they can publish their recipes (e.g., ingredients, instructions, etc.) right here for others to implement as <a href ="./tag/GeoBooster" style = "font-weight: bold">GeoBoosters!</a></p>
				<p><b>GeoMaker projects should include:</b></p>
				<ul>
					<li>photos of what you have made</li>
					<li>diagrams of your project</li>
					<li>ingredients (e.g., detailed component list with web links)</li>
					<li>step by step instructions</li>
					<li>links to external resources</li>			
				</ul>
				<hr />
				<p><b><a href="" target="_blank"><i class="icon icon-film"></i> Watch a 30 second video on posting GeoMaker Projects&#33; &raquo;</a></b></p>
			<% elsif params[:tags].include? "GeoBooster" %>
				<h3 class="hidden-phone"><i class="icon-file"></i> What's a <br />GeoBooster?</h3>
				<h4 class="visible-phone"><i class="icon-file"></i> What's a GeoBooster?</h4>
				<p class="visible-phone"><a onClick="$('#GeoBooster-note-detail').toggleClass('hidden-phone')">Read more &raquo;</a></p>
				<div id="GeoBooster-note-detail" class="hidden-phone">
				<p>Sometimes you will be the <a href ="./tag/GeoDreamer" style = "font-weight: bold">GeoDreamer</a> or the <a href ="./tag/GeoMaker" style = "font-weight: bold">GeoMaker</a>.  And sometimes you will love someone else's idea or project implementation.  When that happens, be a GeoBooster, and try to build these ideas yourself.  Test them out, have fun with them, have events around them, share your experiences, and recommend changes and enhancements!  Share these projects with your friends, or with your kid's teachers.</p>
				<p><b>GeoBoosters can help by sharing:</b></p>
				<ul>
					<li>event announcements</li>
					<li>requests for troubleshooting</li>
					<li>reports from a field test</li>
					<li>ideas for enhancements</li>
				</ul>
				<hr />
				<p><b><a href="" target="_blank"><i class="icon icon-film"></i> Watch a 30 second video on posting GeoBooster experiences&#33; &raquo;</a></b></p>
			<% else %>
				<h3 class="hidden-phone"><i class="icon-file"></i> Don&#39;t forget <br /> to tag&#33;</h3>
				<h4 class="visible-phone"><i class="icon-file"></i> Don&#39;t forget to tag&#33;</h4>
				<p class="visible-phone"><a onClick="$('#note-detail').toggleClass('hidden-phone')">Read more &raquo;</a></p>
				<div id="note-detail" class="hidden-phone">
				<p>Make sure to tag your post as a <a href ="./tag/GeoDreamer" style = "font-weight: bold">GeoDreamer</a>, <a href ="./tag/GeoMaker" style = "font-weight: bold">GeoMaker</a> or <a href ="./tag/GeoBooster" style = "font-weight: bold">GeoBooster</a>.  This will help people discover your post!  GeoDreamers share their GeoDreams, which can include sketches and diagrams of their ideas, outlandish and unfounded ideas or others&#39; ideas that they would like to see become reality&#33;  GeoMakers share their projects, which can include photos of what they have made, diagrams of their projects, ingredients, step by step instructions, or links to external resources.  GeoBoosters share event announcements, requests for troubleshooting, reports from a field test, and ideas for enhancements.</p>
				<hr />
			<% end %>
		<% else %>
			<h3 class="hidden-phone"><i class="icon-file"></i> Don&#39;t forget <br /> to tag&#33;</h3>
			<h4 class="visible-phone"><i class="icon-file"></i> Don&#39;t forget to tag&#33;</h4>
			<p class="visible-phone"><a onClick="$('#note-detail').toggleClass('hidden-phone')">Read more &raquo;</a></p>
			<div id="note-detail" class="hidden-phone">
			<p>Make sure to tag your post as a <a href ="./tag/GeoDreamer" style = "font-weight: bold">GeoDreamer</a>, <a href ="./tag/GeoMaker" style = "font-weight: bold">GeoMaker</a> or <a href ="./tag/GeoBooster" style = "font-weight: bold">GeoBooster</a>.  This will help people discover your post!  GeoDreamers share their GeoDreams, which can include sketches and diagrams of their ideas, outlandish and unfounded ideas or others&#39; ideas that they would like to see become reality&#33;  GeoMakers share their projects, which can include photos of what they have made, diagrams of their projects, ingredients, step by step instructions, or links to external resources.  GeoBoosters share event announcements, requests for troubleshooting, reports from a field test, and ideas for enhancements.</p>
			<hr />
		<% end %>
	<hr />
      <div class="sidebar-nav">
        <ul class="nav nav-list">
          <li class="nav-header">More</li>
          <li><a href="/getting-started">Getting started with GeoMakers</a></li>
          <li><a href="/wiki/posting-research">About posting research</a></li>
          <li><a href="/wiki/authoring-help#Advanced+formatting">Advanced formatting</a></li>
        </ul>
      </div>
    </div>
  <% end %>
</div>

<div class="span9">
  <% 
  if @node && params[:action] != "create"
    url = { :controller => "notes", :action => "update", :id => params[:id] }
  else 
    url = { :controller => "notes", :action => "create", :id => params[:id] }
  end 
  %>
  <%= form_for @node, :as => :drupal_node, :url => url do |f| %>
    <% if f.error_messages != "" %><div class="alert alert-error"><%= f.error_messages :header_message => "Your note couldn't be saved." %></div><% end %>
  <% end %>

  <%= form_for @revision, :as => :drupal_node_revision, :url => url, :html => {:class => "form well"} do |f| %>

    <% if f.error_messages != "" %><div class="alert alert-error"><%= f.error_messages :header_message => "Your note couldn't be saved." %></div><% end %>

    <%= render :partial => "editor/main_image" %>

    <% if params[:template] == "question" %>
      <h3 style="margin-top:0;">Ask a question of the community</h3>
    <% else %>
      <h3 style="margin-top:0;">Share your work</h3>
    <% end %>

    <input id="title" tabindex="1" name="title" type="text" class="span9" placeholder="Title" value="<%= @node.title if @node %><%= "Question: " if params[:template] == "question" %>"><br />
    <input id="has_main_image" type="hidden" name="has_main_image" value="<% if @node && @node.main_image %>true<% end %>" />
    <input id="main_image" type="hidden" name="main_image" value="<% if @node && @node.main_image(:rails) %><%= @node.main_image(:rails).id %><% else %><%= params[:main_image] %><% end %>" />
    <input id="node_images" type="hidden" name="node_images" value="" />

    <script>
      $D = {
        uid: <%= current_user.uid %>,
        type: 'note'
      }
    </script>

    <%= render :partial => 'editor/editor' %>

    <div class="control-group">
    <div class="input-prepend">
      <span class="add-on"><i class="icon-tags"></i></span>
      <input name="remote" type="hidden" value="true" />
  
      <input autocomplete="off" id="taginput" tabindex="3" name="tags" type="text" <% if params[:tags] || (@node && @node.tagnames) %>value="<%= params[:tags] || @node.tagnames.join(',') %>"<% else %>placeholder="balloon-mapping,gulf-coast"<% end %> data-provide="typeahead" />
      <script>
        jQuery(document).ready(function() {
  
          $('#taginput').typeahead({
            source: function (typeahead, input) {
              query = input.split(',')[input.split(',').length-1]
              if (query.length > 2) {
                return $.post('/tag/suggested/'+query, {}, function (data) {
                  return typeahead.process(data)
                })
              }
            },
            menu: '<ul id="tagtypeahead" class="typeahead dropdown-menu"></ul>',
            autoselect: false,
            matcher: function() { return true; },
            onselect: function(text,original_text) { 
              original_text = original_text.split(',')
              original_text.pop()
              original_text = original_text.join(',')
              if (original_text == '') $('#taginput').val(text)
              else $('#taginput').val(original_text+','+text)
            }
          });
  
        });
      </script>
    </div>
    </div>

    <p class="hide alert alert-warning">Consider adding a lead image to illustrate your post! (see above right)</p>

    <div class="hidden-phone">
      <a id="publish" tabindex="5" class="publish btn btn-primary btn-large">Publish</a>
      <a tabindex="6" data-previewing-text="Previewing (click to edit)" class="btn btn-large preview-btn" onClick="$E.toggle_preview()">Preview</a>
    </div>
    <div class="visible-phone btn-group">
      <a id="publish" class="publish btn btn-primary btn-large">Publish</a>
      <a data-previewing-text="Edit" class="btn btn-large preview-btn" onClick="$E.toggle_preview()">Preview</a>
    </div>
    <br />
    <p>By publishing, you agree to <a target="_blank" href="/licenses">open source your work</a> so that others may use it.</p>
  <% end %>
</div>
<script>
  (function(){
    $E.initialize()
    $('#side-fileinput').bind('focus',function(e) { $('#side-dropzone').css('border-color','#4ac') })
    $('#side-fileinput').bind('focusout',function(e) { $('#side-dropzone').css('border-color','#ccc') })
    var warn_image = <%= params[:template] == "question" %>;
    publish = function(e) {
      if ($('#main_image').val() == "" && $('#has_main_image').val() != "true" && !warn_image) {
        // prompt to choose a lead image
        warn_image = true;
        $('.side-dropzone').css('border-color','#d99')
        $('.side-dropzone').css('background','#fcc')
        alert_notice('Click <b>Publish</b> again to publish without a main image, but it is recommended that you add one.', {'scroll': true})
      } else {
        $('#new_drupal_node_revision').submit()
      }
    }
    $(".publish").bind("click",publish)
    $(".publish").bind("keydown",function(e) {
      if (e.which == 32 || e.which == 13) publish()
    })
    if ($E.textarea.val() == "") $E.apply_template("<%= params[:template] || 'default'%>")
  })()
</script>

